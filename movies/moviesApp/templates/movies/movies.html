{% extends "movies/base.html" %}
{% load static %}

{% block title %}Catálogo de Filmes{% endblock %}

{% block extra_head %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'moviesApp/css/movies.css' %}">
{% endblock %}

{% block content %}
<form method="get" action="{% url 'movies' %}" class="search-form">
  <div class="search-field">
    <input type="text" name="q" placeholder="Digite o nome do filme" value="{{ query|default:'' }}" />
    <button type="submit" aria-label="Buscar">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
        <circle cx="11" cy="11" r="8"></circle>
        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
      </svg>
    </button>
  </div>
</form>

<div class="page-grid {% if not user.is_authenticated %}no-sidebar{% endif %}">
  <main class="main-col">
    {% if query %}
    {% if results %}
    <div class="grid">
      {% for movie in results %}
      <a href="{% url 'movie_details' movie.id %}" class="card">
        {% if movie.poster_path %}
        <img src="https://image.tmdb.org/t/p/w200{{ movie.poster_path }}" alt="Poster de {{ movie.title }}">
        {% else %}
        <div style="width:181.75px; height: 272.625px; background-color:#ddd;"></div>
        {% endif %}
        <div class="info">
          <h3>{{ movie.title }}</h3>
          <div class="meta">
            <span>{{ movie.year }}</span>
            {% if movie.genre %}<span>{{ movie.genre }}</span>{% endif %}
          </div>
        </div>
      </a>
      {% endfor %}
    </div>
    {% else %}
    <div class="empty">
      <p>Nenhum resultado encontrado para "{{ query }}".</p>
    </div>
    {% endif %}
    {% else %}
    {% if movies %}
    <div class="grid">
      {% for movie in movies %}
      <a href="{% url 'movie_details' movie.id %}" class="card">
        {% if movie.poster_path %}
        <img src="https://image.tmdb.org/t/p/w200{{ movie.poster_path }}" alt="Poster de {{ movie.title }}">
        {% endif %}
        <div class="info">
          <h3>{{ movie.title }}</h3>
          <div class="meta">
            <span>{{ movie.year }}</span>
            {% if movie.genre %}<span>{{ movie.genre }}</span>{% endif %}
          </div>
        </div>
      </a>
      {% endfor %}
    </div>
    {% else %}
    <div class="empty">
      <p>Nenhum filme popular disponível no momento.</p>
      <p>Use a busca para encontrar sugestões.</p>
    </div>
    {% endif %}
    {% endif %}
  </main>

  {% if user.is_authenticated %}
  <aside class="side-col">
    <section class="user-lists">
      <h3>Suas listas</h3>
      {% if user_lists and user_lists.count > 0 %}
      <div class="lists-wrap">
        {% for lst in user_lists %}
        <div class="user-list" id="list-{{ lst.id }}" data-edit-url="{% url 'edit_list' lst.id %}" role="link"
          tabindex="0">
          <div class="list-header">
            <a href="{% url 'view_list' lst.id %}"><strong>{{ lst.name }}</strong></a>
            {% if lst.description %}
            <p class="list-desc">{{ lst.description }}</p>
            {% endif %}
          </div>

          <div class="list-row">
            {% if lst.movies.count > 0 %}
            <div class="movie-row">
              {% for m in lst.movies.all %}
              <div class="list-poster" title="{{ m.title }}">
                {% if m.poster %}
                <img src="{{ m.poster }}" alt="{{ m.title }} poster">
                {% else %}
                <div class="poster-placeholder"></div>
                {% endif %}
              </div>
              {% endfor %}
            </div>
            {% else %}
            <div class="empty small">
              <p>Esta lista ainda não contém filmes.</p>
            </div>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
      <a class="btn-primary" href="{% url 'user_lists' %}">Gerenciar listas</a>
      {% else %}
      <div class="empty">
        <p>Você ainda não tem listas. <a href="{% url 'user_lists' %}">Crie a sua</a></p>
      </div>
      {% endif %}
    </section>
  </aside>
  {% endif %}
</div>
{% endblock %}